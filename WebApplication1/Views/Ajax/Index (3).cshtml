@model WebApplication1.Models.viewModel

@{
    ViewBag.Title = "Index";
}

<tr></tr>
<p>
    <button id="btnNewProduct" class="btn btn-primary">New Client</button>
</p>
@using (Ajax.BeginForm("Add", "Ajax", null, new { enctype = "multipart/form-data", id = "AjaxForm" }))
    {
<div id="pnlNewProduct">
    <table id="tblAddProduct">
        <tr>
            <td>
                Name
            </td>
            <td>
                @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control" } })
                @*@Html.ValidationMessageFor(model => model.Name, null, new { @class = "text-danger" })*@

            </td>
        </tr>
        <tr>
        <tr>
            <td>
                Date Of Birth
            </td>
            <td>

                <input type="date" class="form-control" id="txtDate" />
                @Html.ValidationMessageFor(model => model.DateOfBirth, null, new { @class = "text-danger" })

            </td>
        </tr>
        <tr>
            <td>
                Address
            </td>
            <td>
                <input type="text" id="txtAddress" class="form-control" />
                @Html.ValidationMessageFor(model => model.Address, null, new { @class = "text-danger" })

            </td>
        </tr>
        <tr>
            <td>
                telephone Number
            </td>
            <td>
                <input type="text" id="txtphoneNumber" class="form-control" />
                @Html.ValidationMessageFor(model => model.Mobile, null, new { @class = "text-danger" })

            </td>
        </tr>
        <tr>
            <td>
                image
            </td>
            <td>
                <div class="col-md-10">
                    <input name="File" id="txtimg" type="file" class="form-control" accept="image/*" onchange="document.getElementById('ImgPrv').src = window.URL.createObjectURL(this.files[0]); $('#ImgPrv').show();">
                    <img id="ImgPrv" style="float:left" src="" width="30" height="30">
                    @Html.ValidationMessageFor(model => model.imageName, null, new { @class = "text-danger" })

                </div>
            </td>
        </tr>
    </table>
    <br />
    <button id="btnSave" class="btn btn-success" style="margin-left:95px;">Save</button>

    <button id="btnUpdate" class="btn btn-success" style="margin-left: 95px;">Update</button>
    <button id="btnCancel" class="btn btn-success" style="margin-left:25px;">Cancel</button>
    <input type="hidden" name="id" value="" id="ID" />
</div>


}


<table class="table" id="ShowAllClient">
    <thead>
        <tr>
            <th>
                Name
            </th>


            <th>
                Address

            </th>
            <th>
                telephone Number
            </th>
            <th>
                Date Of Birth
            </th>
            <th>
                image
            </th>
            <th></th>
        </tr>
    </thead>
    @*
        <tbody class="tbody"></tbody>*@
</table>
@section Scripts{
    <link href="~/Content/DataTables/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="~/Content/DataTables/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/DataTables/css/buttons.dataTables.css" rel="stylesheet" />
    <script src="~/Scripts/DataTables/dataTables.buttons.min.js"></script>
    <script src="~/Scripts/DataTables/buttons.flash.min.js"></script>
    <script src="~/Scripts/DataTables/pdfmake.min.js"></script>
    <script src="~/Scripts/DataTables/jszip.min.js"></script>
    <script src="~/Scripts/DataTables/vfs_fonts.js"></script>
    <script src="~/Scripts/DataTables/buttons.print.min.js"></script>
    <script src="~/Scripts/DataTables/buttons.html5.min.js"></script>
    <script src="~/Scripts/DataTables/jquery.dataTables.min.js"></script>
    <script src="~/Scripts/DataTables/dataTables.bootstrap.min.js"></script>
    <script src="//cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script>

    $(document).ready(function () {
        loadData();
        $('#AjaxForm').hide();
        $('#btnNewProduct').click(function () {
            ClearData();
            $('#AjaxForm').show(2000);
            $('#btnUpdate').hide();
            $('#btnSave').show();
        })
        $('#btnCancel').click(function () {
            $('#AjaxForm').hide(2000);
            ClearData();
        })
        $('#btnSave').click(function () {

                    var fileUpload = $("#txtimg").get(0);
                    var files = fileUpload.files;

                    var fileData = new FormData();

                    fileData.append(files[0].name, files[0]);
                    var Name = $('#txtName').val();
                    var birthDate = $('#txtDate').val();
                    var Adress = $('#txtAddress').val();
                    var Mobile = $('#txtphoneNumber').val();
                    var image = $('#txtimg').val();
                    //var Image = $('#txtimg').val();

                    $.ajax({
                        url: "/Ajax/Add?Name=" + Name + "&Address=" + Adress +
                "&Mobile=" + Mobile +
                            "&DateOfBirth=" + birthDate + "&imageName=" + image + "&ISAdd=false",
                        type: 'post',
                        datatype: 'json',
                        contentType: false,
                        processData: false,
                        async: false,
                        data: fileData,
                        success: function (response) {
                            toastr.success("the recored updated successfully")
                            loadData();
                        }
                    });
                }


       )
        $('#btnUpdate').click(function () {
            var fileUpload = $("#txtimg").get(0);
            var files = fileUpload.files;

            var fileData = new FormData();

            fileData.append(files[0].name, files[0]);
            name = $('#txtName').val();
           // Date = $('#txtDate').val();
           // image = $('#txtimg').val();
            Address = $('#txtAddress').val();
            phone = $('#txtphoneNumber').val();
            id = $('#ID').val();

            $.ajax({

                url: "/Ajax/Edit?Name=" + name +
                    "&Address=" + Address +
                    "&DateOfBirth=" + "11/21/1993"+
                    "&id=" + id +
                    "&Mobile=" + phone
                   ,
                type: "POST",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    if (result == "Success") {
                        toastr.success("the recored added successfully")

                        loadData();
                        ClearData();
                    }
                    else {
                        toastr.error("somthing wrong please try again")
                    }
                }

            });


        })

    })
    function ClearData() {
        $('#txtName').val('');
        $('#txtDate').val('');
        $('#txtAddress').val('');
        $('#txtphoneNumber').val('');
        $('#txtimg').val('');

    }
    var loadData = function () {
        //loadData();
        $.ajax({
            url: "/Ajax/GetAllClient",
            method: 'GET',
        }).done(function (data, s, xhr) {
            // $("#ShowAllClient").dataTable().fnDestroy();

            $("#ShowAllClient").DataTable({
                "data": data,
                "responsive": true,
                "retrieve": true,
                "ordering": false,
                //"dom": 'Bfrtip',
                "buttons": [
                    { "extend": 'pdf', "text": 'PDF', "className": 'btn btnPrint btn-success btn-sm' },
                    { "extend": 'copy', "text": 'Copy', "className": 'btn btnPrint btn-success btn-sm' },
                    { "extend": 'excel', "text": 'Excel', "className": 'btn btnPrint btn-success btn-sm' },
                    { "extend": 'csv', "text": 'CSV', "className": 'btn btnPrint btn-success btn-sm' },
                    { "extend": 'print', "text": 'Print', "className": 'btn btnPrint btn-success btn-sm' },
                ],

                "columns": [

                    { "data": "Name" },
                    { "data": "Address" },
                    { "data": "Mobile" },
                    { "data": "DateOfBirthstr" },
                    //{ "data": "imageName" },
                    {
                        "render": function (data, type, full, meta) {
                            return '<img src="../images/' + full.imageName + '"style="width:120px;height:120px"/>';
                        }
                    },
                    {
                        "render": function (data, type, full, meta) {
                            return '<input type="button" onclick="updateclient(' + full.id + ')" class="btn btn-success"  value="Update" />&nbsp;&nbsp;' +
                                '<input type="button" onclick="Deletclient(' + full.id + ')" class="btn btn-danger"  value="Delete" />';

                        }
                    },
                ]
            });

        })
    }
    
        @*$.ajax({
            url: "/Ajax/GetAllClient",
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                var html = '';
                $.each(result, function (key, item) {
                    html += '<tr>';
                    html += '<td>' + item.Name + '</td>';
                    html += '<td>' + item.Address + '</td>';
                    html += '<td>' + item.Mobile + '</td>';
                    html += '<td>' + item.DateOfBirthstr;
                    html += '</td>';
                    html += '<td><img src="' + '@Url.Content("~/images/")' + item.imageName + '"width="30px" height="30px"></td>';
                    html += '<td><a href="javascript:void(0);" onclick=updateclient(' + item.id + '); return false;>' +
                        '<i class="fa fa-edit" style="font-size:x-large;color:blue"></i><\a>' +
                        '&nbsp&nbsp&nbsp<a href="javascript:void(0);" onclick=Deletclient(' + item.id +
                        ');return false;><i value="Delete" class="fa fa-trash" style="font-size:x-large;color:red"></i><\a>' +
                        '</td>';
                    html += '</tr>';


                });
                $('.tbody').html(html);
                toastr.success("data loaded successfully")
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
            }
        });*@
    
    function updateclient(id) {
        $('#ID').val(id);
        ClearData();
        $.ajax({
            url: "/Ajax/GetClient?id=" + id,
            data: '',
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {

                $('#pnlNewProduct').show(2000);
                $('#btnSave').hide();
                $('#btnUpdate').show();
                $('#txtName').val(result.Name);
                $('#ImgPrv').attr('src', '../images/' + result.imageName);

                $('#txtDate').val(result.DateOfBirthstr);

                $('#txtphoneNumber').val(result.Mobile);
                $('#txtAddress').val(result.Address);


               // $('#txtimg').val(result.imageName);


            },
            error: function (errormessage) {
                alert(errormessage.responseText);
            }
        });
    }
    function Deletclient(id) {
        if (confirm("Are you sure you want to delete this Record?")) {
            $.ajax({
                url: "/Ajax/Delete?id=" + id,
                type: "Get",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    if (result == "Success") {
                        toastr.success("the recored deleted successfully")
                        loadData();
                        ClearData();
                    }
                    else {
                        toastr.error("somthing wrong recored not deleted")
                    }

                }

            });
        }



    }
    </script>

    }
