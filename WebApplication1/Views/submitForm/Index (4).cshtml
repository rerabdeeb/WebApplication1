
@model WebApplication1.Models.viewModel

@*@model IEnumerable<WebApplication1.Models.viewModel>*@
@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

<p>
    <button id="btnNewProduct" class="btn btn-primary">New Client</button>
</p>
<div id="pnlNewProduct">
    <table id="tblAddProduct">
        <tr>
            <td>
                Name
            </td>
            <td>
                <input type="text" class="form-control" id="txtName" />

            </td>
        </tr>
        <tr>
        <tr>
            <td>
                Date Of Birth
            </td>
            <td>
                <input type="text" class="form-control" id="txtDate" />

            </td>
           
        </tr>
        <tr>
            <td>
                Address
            </td>
            <td>
                <input type="text" id="txtAddress" class="form-control" />

            </td>
        </tr>
        <tr>
            <td>
                telephone Number
            </td>
            <td>
                <input type="text" id="txtphoneNumber" class="form-control" />

            </td>
        </tr>
        <tr>
            <td>
                image
            </td>
            <td>
                <div class="col-md-10">
                    <input name="File" id="txtimg" type="file" class="form-control" accept="image/*" onchange="document.getElementById('ImgPrv').src = window.URL.createObjectURL(this.files[0]); $('#ImgPrv').show();">
                    <img id="ImgPrv" style="float:left" src="" width="30" height="30">
                </div>
            </td>
        </tr>
    </table>
    <br />
    <button id="btnSave" class="btn btn-success" style="margin-left:95px;">Save</button>

    <button id="btnUpdate" class="btn btn-success" style="margin-left: 95px;">Update</button>
    <button id="btnCancel" class="btn btn-success" style="margin-left:25px;">Cancel</button>
    <input type="hidden" name="id" value="" id="ID" />
</div>
<table class="table">
    <thead>
        <tr>
            <th>
                Name
            </th>


            <th>
                Address

            </th>
            <th>
                telephone Number
            </th>
            <th>
                Date Of Birth
            </th>
            <th>
                image
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody class="tbody"></tbody>
</table>
<script>
    $(document).ready(function () {
        loadData();
        $('#pnlNewProduct').hide();
        $('#btnNewProduct').click(function () {
            ClearData();
            $('#pnlNewProduct').show(2000);
            $('#btnUpdate').hide();
            $('#btnSave').show();

        })
        $('#btnCancel').click(function () {
            $('#pnlNewProduct').hide(2000);
            ClearData();
        })
        $('#btnSave').click(function () {

                    var fileUpload = $("#txtimg").get(0);
                    var files = fileUpload.files;

                    var fileData = new FormData();

                    fileData.append(files[0].name, files[0]);
                    var Name = $('#txtName').val();
                    var birthDate = $('#txtDate').val();
                    var Adress = $('#txtAddress').val();
                    var Mobile = $('#txtphoneNumber').val();

                    //var Image = $('#txtimg').val();

                    $.ajax({
                        url: "/submitForm/Add?Name=" + Name + "&address=" + Adress +
                "&telephoneNumper=" + Mobile +
                "&dateOfBirth=" + birthDate ,
                        type: 'post',
                        datatype: 'json',
                        contentType: false,
                        processData: false,
                        async: false,
                        data: fileData,
                        success: function (response) {
                            alert(response);
                            loadData();
                        }
                    });
                }


       )
        $('#btnUpdate').click(function () {
            var fileUpload = $("#txtimg").get(0);
            var files = fileUpload.files;

            var fileData = new FormData();

            fileData.append(files[0].name, files[0]);
            name = $('#txtName').val();
            Date = $('#txtDate').val();
            image = $('#txtimg').val();
            Address = $('#txtAddress').val();
            phone = $('#txtphoneNumber').val();
            id = $('#ID').val();

            $.ajax({

                url: "/submitForm/Edit?Name=" + name +
                    "&address=" + Address +
                    "&dateOfBirthstr=" + Date +
                    "&imageName=" + image +
                    "&id=" + id +
                    "&telephoneNumper=" + phone
                   ,
                type: "POST",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    if (result == "Success") {
                        alert("Saved Sussefully");

                        loadData();
                        ClearData();
                    }
                    else {
                        alert('somthing wrong');
                    }
                }

            });


        })

    })
    function ClearData() {
        $('#txtName').val('');
        $('#txtDate').val('');
        $('#txtAddress').val('');
        $('#txtphoneNumber').val('');
        $('#txtimg').val('');

    }
    function loadData() {

        $.ajax({
            url: "/submitForm/GetAllClient",
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                var html = '';
                $.each(result, function (key, item) {
                    html += '<tr>';
                    html += '<td>' + item.Name + '</td>';
                    html += '<td>' + item.Address + '</td>';
                    html += '<td>' + item.Mobile + '</td>';
                    html += '<td>' + item.DateOfBirthstr;
                    html += '</td>';
                    html += '<td><img src="' + '@Url.Content("~/images/")' + item.imageName + '"width="30px" height="30px"></td>';
                    html += '<td><a href="javascript:void(0);" onclick=updateclient(' + item.id + '); return false;>' +
                        '<i class="fa fa-edit" style="font-size:x-large;color:blue"></i><\a>' +
                        '&nbsp&nbsp&nbsp<a href="javascript:void(0);" onclick=Deletclient(' + item.id +
                        ');return false;><i value="Delete" class="fa fa-trash" style="font-size:x-large;color:red"></i><\a>' +
                        '</td>';
                    html += '</tr>';


                });
                $('.tbody').html(html);
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
            }
        });
    }
    function updateclient(id) {
        $('#ID').val(id);

        $.ajax({
            url: "/submitForm/GetClient?id=" + id,
            data: '',
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                

                $('#pnlNewProduct').show(2000);
                $('#btnSave').hide();
                $('#btnUpdate').show();
                $('#txtName').val(result.Name);
                $('#txtDate').val(result.DateOfBirth);
                
                $('#txtphoneNumber').val(result.Mobile);
                $('#txtAddress').val(result.Address);
                //$('#txtimg').val(result.imageName);
                
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
            }
        });
    }
    function Deletclient(id) {
        if (confirm("Are you sure you want to delete this Record?")) {
            $.ajax({
                url: "/submitForm/Delete?id=" + id,
                type: "Get",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    if (result == "Success") {
                        alert("deleted Sussefully");
                        loadData();
                        ClearData();
                    }

                }

            });
        }



    }
</script>


